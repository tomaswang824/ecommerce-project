# ğŸš€ åç«¯ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”

| å¹³å° | å…è´¹é¢åº¦ | éš¾åº¦ | æ¨èåº¦ |
|------|---------|------|--------|
| **Railway** | $5/æœˆå…è´¹é¢åº¦ | â­ ç®€å• | â­â­â­â­â­ å¼ºçƒˆæ¨è |
| **Render** | 750å°æ—¶/æœˆ | â­â­ ä¸­ç­‰ | â­â­â­â­ æ¨è |
| **Fly.io** | 3ä¸ªå…è´¹åº”ç”¨ | â­â­â­ è¾ƒéš¾ | â­â­â­ å¯é€‰ |
| **Heroku** | æ”¶è´¹ | â­â­ ä¸­ç­‰ | â­â­ ä¸æ¨èï¼ˆæ— å…è´¹ç‰ˆï¼‰ |

---

## ğŸ¯ æ–¹æ¡ˆ 1: Railway éƒ¨ç½²ï¼ˆæ¨èï¼‰â­â­â­â­â­

### ä¸ºä»€ä¹ˆé€‰æ‹© Railwayï¼Ÿ
- âœ… å…è´¹ $5/æœˆé¢åº¦ï¼ˆè¶³å¤Ÿå°é¡¹ç›®ä½¿ç”¨ï¼‰
- âœ… è‡ªåŠ¨æ£€æµ‹ Node.js é¡¹ç›®
- âœ… å†…ç½® MongoDB æ”¯æŒ
- âœ… è‡ªåŠ¨ HTTPS
- âœ… è‡ªåŠ¨éƒ¨ç½²ï¼ˆè¿æ¥ GitHub åï¼‰
- âœ… ç®€å•æ˜“ç”¨çš„ç•Œé¢

---

### æ­¥éª¤ 1: å‡†å¤‡åç«¯ä»£ç 

#### 1.1 åˆ›å»º Railway é…ç½®æ–‡ä»¶

åœ¨ `backend/` ç›®å½•åˆ›å»º `railway.json`ï¼š

```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "npm start",
    "healthcheckPath": "/api/health",
    "healthcheckTimeout": 100,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

#### 1.2 ä¿®æ”¹ `backend/package.json`

ç¡®ä¿åŒ…å«å¯åŠ¨è„šæœ¬ï¼š

```json
{
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}
```

#### 1.3 æ·»åŠ å¥åº·æ£€æŸ¥æ¥å£

åœ¨ `backend/server.js` æ·»åŠ ï¼ˆåœ¨å…¶ä»–è·¯ç”±ä¹‹å‰ï¼‰ï¼š

```javascript
// å¥åº·æ£€æŸ¥æ¥å£
app.get('/api/health', (req, res) => {
  res.status(200).json({
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime()
  })
})
```

#### 1.4 æ›´æ–° CORS é…ç½®

ä¿®æ”¹ `backend/server.js` çš„ CORS éƒ¨åˆ†ï¼š

```javascript
const cors = require('cors')

const allowedOrigins = [
  'http://localhost:3000',
  'http://localhost:3003',
  process.env.FRONTEND_URL || 'https://your-project.vercel.app'
]

app.use(cors({
  origin: function(origin, callback) {
    // å…è®¸æ²¡æœ‰ origin çš„è¯·æ±‚ï¼ˆå¦‚ç§»åŠ¨åº”ç”¨ã€Postmanï¼‰
    if (!origin) return callback(null, true)

    if (allowedOrigins.indexOf(origin) !== -1 ||
        origin.endsWith('.vercel.app')) {
      callback(null, true)
    } else {
      callback(new Error('Not allowed by CORS'))
    }
  },
  credentials: true
}))
```

---

### æ­¥éª¤ 2: éƒ¨ç½²åˆ° Railway

#### 2.1 æ³¨å†Œ Railway è´¦å·

1. è®¿é—®ï¼šhttps://railway.app
2. ç‚¹å‡» **Start a New Project**
3. ä½¿ç”¨ **GitHub** è´¦å·ç™»å½•ï¼ˆæ¨èï¼‰

#### 2.2 åˆ›å»ºæ–°é¡¹ç›®

1. ç‚¹å‡» **New Project**
2. é€‰æ‹© **Deploy from GitHub repo**
3. é€‰æ‹© `ecommerce-project` ä»“åº“
4. Railway ä¼šè‡ªåŠ¨æ£€æµ‹åˆ° Node.js é¡¹ç›®

#### 2.3 é…ç½® Root Directory

**é‡è¦ï¼** Railway é»˜è®¤ä¼šå°è¯•éƒ¨ç½²æ•´ä¸ªä»“åº“ï¼Œéœ€è¦æŒ‡å®šåç«¯ç›®å½•ï¼š

1. é¡¹ç›®åˆ›å»ºåï¼Œç‚¹å‡»é¡¹ç›®åç§°
2. ç‚¹å‡» **Settings** æ ‡ç­¾
3. æ‰¾åˆ° **Root Directory**
4. è®¾ç½®ä¸ºï¼š`backend`
5. ç‚¹å‡» **Save**

#### 2.4 æ·»åŠ  MongoDB æ•°æ®åº“

**æ–¹å¼ A: ä½¿ç”¨ Railway å†…ç½® MongoDBï¼ˆæ¨èï¼‰**

1. åœ¨é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡» **+ New**
2. é€‰æ‹© **Database**
3. é€‰æ‹© **Add MongoDB**
4. Railway ä¼šè‡ªåŠ¨åˆ›å»º MongoDB å®ä¾‹
5. è‡ªåŠ¨ç”Ÿæˆè¿æ¥å­—ç¬¦ä¸²å¹¶æ³¨å…¥ç¯å¢ƒå˜é‡ `MONGO_URL`

**æ–¹å¼ B: ä½¿ç”¨ç°æœ‰ MongoDB Atlas**

1. ç‚¹å‡»é¡¹ç›®åç§°
2. ç‚¹å‡» **Variables** æ ‡ç­¾
3. ç‚¹å‡» **+ New Variable**
4. æ·»åŠ ï¼š
   ```
   MONGODB_URI = mongodb+srv://tomaswang824_db_user:FjOq4CCXzIFTNXWC@cluster0.lttikq2.mongodb.net/ecommerce_prod?retryWrites=true&w=majority&appName=Cluster0
   ```

#### 2.5 é…ç½®ç¯å¢ƒå˜é‡

åœ¨ **Variables** æ ‡ç­¾æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

```bash
# æœåŠ¡å™¨é…ç½®
PORT=5000
NODE_ENV=production

# MongoDBï¼ˆå¦‚æœä½¿ç”¨ Railway MongoDBï¼Œä¼šè‡ªåŠ¨è®¾ç½® MONGO_URLï¼‰
# MONGODB_URI=mongodb+srv://... ï¼ˆå¦‚æœä½¿ç”¨ Atlasï¼‰

# JWT å¯†é’¥ï¼ˆé‡è¦ï¼å¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET=your-super-secret-jwt-key-min-32-characters-long

# CORS é…ç½®
FRONTEND_URL=https://your-project.vercel.app

# å¯é€‰ï¼šæ—¥å¿—çº§åˆ«
LOG_LEVEL=info
```

**ç”Ÿæˆå®‰å…¨çš„ JWT_SECRETï¼š**
```bash
# åœ¨ç»ˆç«¯è¿è¡Œ
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

#### 2.6 éƒ¨ç½²

1. é…ç½®å®Œæˆåï¼ŒRailway ä¼šè‡ªåŠ¨å¼€å§‹æ„å»ºå’Œéƒ¨ç½²
2. ç­‰å¾… 2-3 åˆ†é’Ÿ
3. éƒ¨ç½²å®Œæˆåï¼Œä¼šæ˜¾ç¤º **Deployment successful**

#### 2.7 è·å–åç«¯ URL

1. ç‚¹å‡» **Settings** æ ‡ç­¾
2. æ‰¾åˆ° **Domains** éƒ¨åˆ†
3. ç‚¹å‡» **Generate Domain**
4. ä¼šç”Ÿæˆç±»ä¼¼ï¼š`https://your-app.up.railway.app`
5. **å¤åˆ¶è¿™ä¸ª URL**ï¼ˆç¨åéœ€è¦é…ç½®åˆ° Vercelï¼‰

---

### æ­¥éª¤ 3: æµ‹è¯•åç«¯ API

#### 3.1 æµ‹è¯•å¥åº·æ£€æŸ¥

åœ¨æµè§ˆå™¨è®¿é—®ï¼š
```
https://your-app.up.railway.app/api/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "status": "ok",
  "timestamp": "2025-10-05T...",
  "uptime": 123.45
}
```

#### 3.2 æµ‹è¯•å•†å“æ¥å£

```
https://your-app.up.railway.app/api/products
```

åº”è¯¥è¿”å›å•†å“åˆ—è¡¨ï¼ˆç©ºæ•°ç»„æˆ–å·²æœ‰æ•°æ®ï¼‰

---

### æ­¥éª¤ 4: è¿æ¥ Vercel å‰ç«¯

#### 4.1 é…ç½® Vercel ç¯å¢ƒå˜é‡

1. è®¿é—® Vercel Dashboard: https://vercel.com/dashboard
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. ç‚¹å‡» **Settings** â†’ **Environment Variables**
4. æ·»åŠ å˜é‡ï¼š

```bash
VITE_API_URL = https://your-app.up.railway.app
```

**æ³¨æ„ï¼šä¸è¦åœ¨ URL æœ«å°¾åŠ æ–œæ ï¼**

#### 4.2 é‡æ–°éƒ¨ç½² Vercel

1. å›åˆ° **Deployments** æ ‡ç­¾
2. ç‚¹å‡»æœ€æ–°éƒ¨ç½²
3. ç‚¹å‡» **â‹¯** â†’ **Redeploy**
4. ç­‰å¾…éƒ¨ç½²å®Œæˆ

#### 4.3 éªŒè¯è¿æ¥

è®¿é—®ä½ çš„ Vercel ç½‘ç«™ï¼Œåº”è¯¥èƒ½çœ‹åˆ°å•†å“æ•°æ®äº†ï¼

---

## ğŸ¯ æ–¹æ¡ˆ 2: Render éƒ¨ç½²

### æ­¥éª¤ 1: æ³¨å†Œ Render

1. è®¿é—®ï¼šhttps://render.com
2. ä½¿ç”¨ GitHub è´¦å·ç™»å½•

### æ­¥éª¤ 2: åˆ›å»º Web Service

1. ç‚¹å‡» **New +** â†’ **Web Service**
2. è¿æ¥ GitHub ä»“åº“ï¼š`ecommerce-project`
3. é…ç½®ï¼š

```
Name: ecommerce-backend
Region: Singapore (æˆ–å…¶ä»–é è¿‘ç”¨æˆ·çš„åŒºåŸŸ)
Branch: main
Root Directory: backend
Runtime: Node
Build Command: npm install
Start Command: npm start
```

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

åœ¨ **Environment** éƒ¨åˆ†æ·»åŠ ï¼š

```bash
PORT=5000
NODE_ENV=production
MONGODB_URI=mongodb+srv://...
JWT_SECRET=your-secret-key
FRONTEND_URL=https://your-project.vercel.app
```

### æ­¥éª¤ 4: é€‰æ‹©è®¡åˆ’

- é€‰æ‹© **Free** è®¡åˆ’
- ç‚¹å‡» **Create Web Service**

### æ­¥éª¤ 5: ç­‰å¾…éƒ¨ç½²

Render ä¼šè‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²ï¼Œå®Œæˆåä¼šæ˜¾ç¤ºæœåŠ¡ URLã€‚

---

## ğŸ¯ æ–¹æ¡ˆ 3: Fly.io éƒ¨ç½²ï¼ˆé«˜çº§ï¼‰

### æ­¥éª¤ 1: å®‰è£… Fly CLI

```bash
# Windows (PowerShell)
powershell -Command "iwr https://fly.io/install.ps1 -useb | iex"

# macOS/Linux
curl -L https://fly.io/install.sh | sh
```

### æ­¥éª¤ 2: ç™»å½•

```bash
fly auth login
```

### æ­¥éª¤ 3: åˆå§‹åŒ–é¡¹ç›®

```bash
cd backend
fly launch
```

ä¼šæç¤ºï¼š
- App name: `ecommerce-backend`
- Region: `sin` (Singapore)
- Create Postgres? `No`
- Deploy now? `No`

### æ­¥éª¤ 4: é…ç½®ç¯å¢ƒå˜é‡

```bash
fly secrets set MONGODB_URI="mongodb+srv://..."
fly secrets set JWT_SECRET="your-secret-key"
fly secrets set NODE_ENV="production"
fly secrets set FRONTEND_URL="https://your-project.vercel.app"
```

### æ­¥éª¤ 5: éƒ¨ç½²

```bash
fly deploy
```

---

## ğŸ“‹ éƒ¨ç½²åé…ç½®æ¸…å•

### âœ… åç«¯æ£€æŸ¥

- [ ] å¥åº·æ£€æŸ¥æ¥å£å¯è®¿é—®
- [ ] API æ¥å£è¿”å›æ­£ç¡®æ•°æ®
- [ ] MongoDB è¿æ¥æˆåŠŸ
- [ ] CORS é…ç½®æ­£ç¡®
- [ ] ç¯å¢ƒå˜é‡å·²è®¾ç½®

### âœ… å‰ç«¯æ£€æŸ¥

- [ ] Vercel ç¯å¢ƒå˜é‡ `VITE_API_URL` å·²è®¾ç½®
- [ ] å‰ç«¯èƒ½æˆåŠŸè°ƒç”¨åç«¯ API
- [ ] å•†å“æ•°æ®æ­£å¸¸æ˜¾ç¤º
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•æ­£å¸¸
- [ ] è´­ç‰©è½¦åŠŸèƒ½æ­£å¸¸

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: 502 Bad Gateway

**åŸå› **ï¼šåç«¯æœªå¯åŠ¨æˆ–å¯åŠ¨å¤±è´¥

**è§£å†³**ï¼š
1. æŸ¥çœ‹ Railway/Render çš„æ—¥å¿—
2. æ£€æŸ¥ `package.json` çš„ `start` è„šæœ¬
3. ç¡®è®¤ MongoDB è¿æ¥å­—ç¬¦ä¸²æ­£ç¡®

### é—®é¢˜ 2: CORS é”™è¯¯

**åŸå› **ï¼šåç«¯æœªå…è®¸å‰ç«¯åŸŸå

**è§£å†³**ï¼š
åœ¨åç«¯æ·»åŠ  Vercel åŸŸååˆ° CORS ç™½åå•

### é—®é¢˜ 3: å‰ç«¯æ˜¾ç¤º "åŠ è½½ä¸­..." ä½†æ²¡æœ‰æ•°æ®

**åŸå› **ï¼š`VITE_API_URL` é…ç½®é”™è¯¯

**è§£å†³**ï¼š
1. æ£€æŸ¥ Vercel ç¯å¢ƒå˜é‡
2. ç¡®ä¿ URL ä¸ä»¥ `/` ç»“å°¾
3. Redeploy Vercel

### é—®é¢˜ 4: MongoDB è¿æ¥å¤±è´¥

**åŸå› **ï¼šIP ç™½åå•é™åˆ¶

**è§£å†³**ï¼š
1. ç™»å½• MongoDB Atlas
2. Network Access â†’ Add IP Address
3. é€‰æ‹© **Allow Access from Anywhere** (`0.0.0.0/0`)

---

## ğŸš€ è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹

é…ç½®å®Œæˆåï¼Œæœªæ¥çš„éƒ¨ç½²æµç¨‹ï¼š

1. **æœ¬åœ°ä¿®æ”¹ä»£ç **
2. **æäº¤åˆ° GitHub**ï¼š
   ```bash
   git add .
   git commit -m "æ›´æ–°åŠŸèƒ½"
   git push
   ```
3. **è‡ªåŠ¨éƒ¨ç½²**ï¼š
   - Railway/Render è‡ªåŠ¨æ£€æµ‹ GitHub æ¨é€
   - è‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²åç«¯
   - Vercel è‡ªåŠ¨éƒ¨ç½²å‰ç«¯

**å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œï¼**

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ä½¿ç”¨ç¯å¢ƒå˜é‡**ï¼šä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
2. **å¯ç”¨ HTTPS**ï¼šæ‰€æœ‰å¹³å°éƒ½é»˜è®¤æä¾›å…è´¹ HTTPS
3. **ç›‘æ§æ—¥å¿—**ï¼šå®šæœŸæŸ¥çœ‹éƒ¨ç½²å¹³å°çš„æ—¥å¿—
4. **è®¾ç½®å‘Šè­¦**ï¼šé…ç½®æœåŠ¡å¼‚å¸¸æ—¶çš„é‚®ä»¶é€šçŸ¥
5. **æ•°æ®å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½ MongoDB æ•°æ®

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹å¹³å°çš„éƒ¨ç½²æ—¥å¿—
2. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
3. æµ‹è¯•åç«¯å¥åº·æ£€æŸ¥æ¥å£
4. æä¾›é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘æ¥å¸®ä½ è§£å†³

---

**ç°åœ¨å¼€å§‹éƒ¨ç½²å§ï¼æ¨èä½¿ç”¨ Railwayï¼Œåªéœ€ 10 åˆ†é’Ÿå³å¯å®Œæˆï¼** ğŸš€
